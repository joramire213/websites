<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Podcast | Momento Presente</title>
  <meta name="description" content="Episodios breves y accionables para familias: pautas de crianza, regulación emocional y bienestar infantil." />
  <link rel="canonical" href="https://momentopresentekids.com/podcasts/" />
  <meta name="theme-color" content="#fffaf1">

  <!-- Medición (coherente con el sitio) -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
  f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-W92DWBFZ');</script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-1RC38KZR1L"></script>
  <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-1RC38KZR1L');</script>

  <!-- Fuentes + Iconos -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@700;800&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script defer src="https://unpkg.com/lucide@latest"></script>

  <!-- CSS del sitio -->
  <link rel="icon" href="../img/favicon.png" type="image/png">
  <link rel="stylesheet" href="../css/style.css">
  <script defer src="../js/layout.js"></script>

  <!-- Datos estructurados: listado de podcasts -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"CollectionPage",
    "name":"Podcast",
    "url":"https://momentopresentekids.com/podcasts/",
    "about":{"@type":"Thing","name":"Psicología infantil"},
    "hasPart":[
      {
        "@type":"AudioObject",
        "name":"Desarrollo del Cerebro Infantil y Adolescente",
        "url":"https://momentopresentekids.com/podcasts/audio/desarrollo_cerebro_infantil.mp4",
        "encodingFormat":"audio/mp4",
        "uploadDate":"2025-09-15"
      },
      {
        "@type":"AudioObject",
        "name":"Cuando mi hijo no quiere ir a clase",
        "url":"https://momentopresentekids.com/podcasts/audio/cuando_no_quiere_ir_a_clase.mp3",
        "encodingFormat":"audio/mpeg",
        "uploadDate":"2025-08-30"
      },
      {
        "@type":"AudioObject",
        "name":"Rutinas de la mañana sin carreras",
        "url":"https://momentopresentekids.com/podcasts/audio/rutinas_manana_sin_carreras.mp4",
        "encodingFormat":"audio/mp4",
        "uploadDate":"2025-08-18"
      }
    ]
  }
  </script>

  <style>
    /* Microestilos solo para el reproductor; lo demás usa style.css */
    .player-card{cursor:pointer; user-select:none;}
    .player-row{display:flex; gap:1rem; align-items:center;}
    .play-btn{display:inline-flex; align-items:center; justify-content:center; width:56px; height:56px; border-radius:999px; border:1px solid rgba(2,6,23,.1); background:#fff;}
    .play-btn:focus-visible{outline:2px solid #1b2a3a; outline-offset:2px;}
    .title-wrap h3{margin:0;}
    .meta{margin:.25rem 0 0; color:#475569; font-size:.92rem;}
    .timeline{position:relative; height:28px; display:flex; align-items:center; cursor:pointer; touch-action:none;}
    .track{position:relative; height:6px; width:100%; background:#e7edf4; border-radius:999px; overflow:hidden;}
    .buffer{position:absolute; left:0; top:0; bottom:0; width:0%; background:#d6e3f3;}
    .bar{position:absolute; left:0; top:0; bottom:0; width:0%; background:#1b2a3a;}
    .thumb{position:absolute; top:50%; transform:translate(-50%,-50%); width:14px; height:14px; border-radius:50%; background:#1b2a3a; border:2px solid #fff; box-shadow:0 1px 3px rgba(2,6,23,.25); pointer-events:none;}
    .time-row{display:flex; justify-content:space-between; font-size:.86rem; color:#475569; margin-top:.25rem;}
  </style>
</head>
<body>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W92DWBFZ" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

  <!-- Header inyectado por js/layout.js -->
  <div id="site-header"></div>

  <main>
    <!-- SIN HERO: el contenido “estalla” directo -->
    <section aria-labelledby="podcast-title">
      <div class="container">
        <h1 id="podcast-title">Podcast</h1>
        <p>Episodios breves y accionables para tu día a día en familia.</p>
      </div>
    </section>

    <!-- (Opcional) Filtros mínimos -->
    <section>
      <div class="container">
        <form class="contact-form" id="podcast-filters" role="search" aria-label="Filtros de episodios" onsubmit="return false;" style="max-width:720px;">
          <div class="form-group full-width">
            <label for="q2">Buscar</label>
            <input id="q2" type="search" placeholder="Palabras clave (ej: sueño, límites, ansiedad)">
          </div>
          <div class="form-group">
            <label for="orden2">Ordenar</label>
            <select id="orden2">
              <option value="recientes">Más recientes</option>
              <option value="titulo">Título (A–Z)</option>
            </select>
          </div>
          <button class="submit-button" id="applyFilters2">Aplicar filtros</button>
          <button type="button" class="submit-button" id="clearFilters2" style="background:#e9eef5;color:#1b2a3a;margin-left:.5rem;">Limpiar</button>
        </form>
      </div>
    </section>

    <!-- Grilla de episodios: cada tarjeta es un reproductor -->
    <section>
      <div class="container">
        <div class="servicios-grid" id="episodesGrid">
          <!-- Episodio 1 (MP4) -->
          <article class="service-card player-card"
                   data-title="Desarrollo del Cerebro Infantil y Adolescente"
                   data-date="2025-09-15"
                   tabindex="0" role="button"
                   aria-label="Reproducir: Desarrollo del Cerebro Infantil y Adolescente">
            <div class="player-row">
              <button class="play-btn" aria-label="Reproducir">
                <i data-lucide="play" aria-hidden="true"></i>
              </button>
              <div style="flex:1;">
                <div class="title-wrap">
                  <h3><span class="card-link">Desarrollo del Cerebro Infantil y Adolescente</span></h3>
                  <p class="meta">Plasticidad cerebral · 23:04</p>
                </div>

                <!-- Timeline -->
                <div class="timeline" aria-label="Línea de tiempo de reproducción" role="slider" tabindex="0"
                     aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                  <div class="track">
                    <div class="buffer"></div>
                    <div class="bar"></div>
                  </div>
                  <div class="thumb" style="left:0%"></div>
                </div>
                <div class="time-row">
                  <small class="time-current">0:00</small>
                  <small class="time-total">0:00</small>
                </div>
              </div>
            </div>
            <audio preload="none" class="audio">
              <source src="./audio/desarrollo_cerebro_infantil.mp4" type="audio/mp4"/>
            </audio>
          </article>

          <!-- Episodio 2 (MP3) -->
          <article class="service-card player-card"
                   data-title="Cuando mi hijo no quiere ir a clase"
                   data-date="2025-08-30"
                   tabindex="0" role="button"
                   aria-label="Reproducir: Cuando mi hijo no quiere ir a clase">
            <div class="player-row">
              <button class="play-btn" aria-label="Reproducir">
                <i data-lucide="play" aria-hidden="true"></i>
              </button>
              <div style="flex:1;">
                <div class="title-wrap">
                  <h3><span class="card-link">Cuando mi hijo no quiere ir a clase</span></h3>
                  <p class="meta">Habilidades sociales · 10:12</p>
                </div>

                <div class="timeline" aria-label="Línea de tiempo de reproducción" role="slider" tabindex="0"
                     aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                  <div class="track">
                    <div class="buffer"></div>
                    <div class="bar"></div>
                  </div>
                  <div class="thumb" style="left:0%"></div>
                </div>
                <div class="time-row">
                  <small class="time-current">0:00</small>
                  <small class="time-total">0:00</small>
                </div>
              </div>
            </div>
            <audio preload="none" class="audio">
              <source src="./audio/cuando_no_quiere_ir_a_clase.mp3" type="audio/mpeg"/>
            </audio>
          </article>

          <!-- Episodio 3 (MP4) -->
          <article class="service-card player-card"
                   data-title="Rutinas de la mañana sin carreras"
                   data-date="2025-08-18"
                   tabindex="0" role="button"
                   aria-label="Reproducir: Rutinas de la mañana sin carreras">
            <div class="player-row">
              <button class="play-btn" aria-label="Reproducir">
                <i data-lucide="play" aria-hidden="true"></i>
              </button>
              <div style="flex:1;">
                <div class="title-wrap">
                  <h3><span class="card-link">Rutinas de la mañana sin carreras</span></h3>
                  <p class="meta">Familia · 7:05</p>
                </div>

                <div class="timeline" aria-label="Línea de tiempo de reproducción" role="slider" tabindex="0"
                     aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                  <div class="track">
                    <div class="buffer"></div>
                    <div class="bar"></div>
                  </div>
                  <div class="thumb" style="left:0%"></div>
                </div>
                <div class="time-row">
                  <small class="time-current">0:00</small>
                  <small class="time-total">0:00</small>
                </div>
              </div>
            </div>
            <audio preload="none" class="audio">
              <source src="./audio/rutinas_manana_sin_carreras.mp4" type="audio/mp4"/>
            </audio>
          </article>
        </div>

        <div class="no-results" id="noResults2" role="status" aria-live="polite" style="display:none;margin-top:1rem;">
          <p>No encontramos episodios con tus filtros. Prueba limpiar o usar otras palabras.</p>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer inyectado por js/layout.js -->
  <div id="site-footer"></div>

  <!-- JS del sitio -->
  <script src="../js/main.js"></script>
  <script>
  (function(){
    // ----------- Filtros básicos -----------
    const grid = document.getElementById('episodesGrid');
    const q = document.getElementById('q2');
    const orden = document.getElementById('orden2');
    const btn = document.getElementById('applyFilters2');
    const clear = document.getElementById('clearFilters2');
    const noResults = document.getElementById('noResults2');

    function applyFilters(){
      const term = (q.value||'').toLowerCase().trim();
      const cards = Array.from(grid.children);
      let visible = 0;
      cards.forEach(card=>{
        const title = (card.dataset.title||'').toLowerCase();
        const show = !term || title.includes(term);
        card.style.display = show ? '' : 'none';
        if(show) visible++;
      });
      const vis = cards.filter(c=>c.style.display!=='none');
      vis.sort((a,b)=>{
        if(orden.value==='titulo') return a.dataset.title.localeCompare(b.dataset.title);
        return (b.dataset.date||'').localeCompare(a.dataset.date||'');
      });
      vis.forEach(el=>grid.appendChild(el));
      noResults.style.display = visible ? 'none' : 'block';
    }
    btn.addEventListener('click', applyFilters);
    clear.addEventListener('click', ()=>{ q.value=''; orden.value='recientes'; applyFilters(); });

    // ----------- Reproductor por tarjeta (play/pause + timeline con seek) -----------
    let currentAudio = null;
    let currentCard  = null;

    function fmt(t){ if(!isFinite(t)) return '0:00'; const m=Math.floor(t/60), s=Math.floor(t%60); return m+':'+String(s).padStart(2,'0'); }

    function setIcon(card, playing){
      const icon = card.querySelector('.play-btn i');
      if(!icon) return;
      icon.setAttribute('data-lucide', playing ? 'pause' : 'play');
      if(window.lucide && typeof lucide.createIcons==='function'){ lucide.createIcons(); }
    }

    function percentToTime(audio, pct){
      pct = Math.min(1, Math.max(0, pct));
      return (audio.duration||0) * pct;
    }

    function attachPlayer(card){
      const audio = card.querySelector('audio.audio');
      const btn   = card.querySelector('.play-btn');
      const tl    = card.querySelector('.timeline');
      const track = card.querySelector('.track');
      const bar   = card.querySelector('.bar');
      const buff  = card.querySelector('.buffer');
      const thumb = card.querySelector('.thumb');
      const cur   = card.querySelector('.time-current');
      const tot   = card.querySelector('.time-total');

      // Play/Pause
      function play(){
        if(currentAudio && currentAudio!==audio){ currentAudio.pause(); if(currentCard) setIcon(currentCard,false); }
        audio.play();
        currentAudio = audio; currentCard = card;
        setIcon(card, true);
      }
      function pause(){ audio.pause(); setIcon(card, false); }
      function toggle(){ audio.paused ? play() : pause(); }

      // Timeline helpers
      let dragging = false;
      function updateFromPointer(clientX){
        const rect = track.getBoundingClientRect();
        const pct = (clientX - rect.left) / rect.width;
        const time = percentToTime(audio, pct);
        audio.currentTime = time;
        const p = Math.min(1, Math.max(0, pct));
        bar.style.width = (p*100)+'%';
        thumb.style.left = (p*100)+'%';
        cur.textContent = fmt(audio.currentTime);
      }

      // Botones / Accesibilidad
      btn.addEventListener('click', (e)=>{ e.stopPropagation(); toggle(); });
      card.addEventListener('click', (e)=>{ if(e.target.closest('.play-btn') || e.target.closest('.timeline')) return; toggle(); });
      card.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); toggle(); }});

      // Cargar metadatos
      audio.addEventListener('loadedmetadata', ()=>{ tot.textContent = fmt(audio.duration); });

      // Progreso visual
      audio.addEventListener('timeupdate', ()=>{
        const p = (audio.currentTime / (audio.duration||1));
        bar.style.width = (p*100)+'%';
        thumb.style.left = (p*100)+'%';
        cur.textContent = fmt(audio.currentTime);
      });

      // Buffering (aprox)
      audio.addEventListener('progress', ()=>{
        if(audio.buffered.length){
          const end = audio.buffered.end(audio.buffered.length-1);
          const pct = end / (audio.duration||1);
          buff.style.width = (Math.min(1, pct)*100)+'%';
        }
      });

      audio.addEventListener('ended', ()=>{ setIcon(card,false); });

      // Seek por click
      tl.addEventListener('click', (e)=>{ updateFromPointer(e.clientX); });

      // Seek por drag (mouse + touch + teclado)
      function onPointerDown(e){
        dragging = true;
        updateFromPointer(e.clientX|| (e.touches && e.touches[0].clientX));
        document.addEventListener('mousemove', onPointerMove);
        document.addEventListener('mouseup', onPointerUp);
        document.addEventListener('touchmove', onPointerMove, {passive:false});
        document.addEventListener('touchend', onPointerUp);
      }
      function onPointerMove(e){
        if(!dragging) return;
        e.preventDefault?.();
        updateFromPointer(e.clientX|| (e.touches && e.touches[0].clientX));
      }
      function onPointerUp(){
        dragging = false;
        document.removeEventListener('mousemove', onPointerMove);
        document.removeEventListener('mouseup', onPointerUp);
        document.removeEventListener('touchmove', onPointerMove);
        document.removeEventListener('touchend', onPointerUp);
      }
      tl.addEventListener('mousedown', onPointerDown);
      tl.addEventListener('touchstart', onPointerDown, {passive:true});

      // Slider accesible con teclado
      tl.addEventListener('keydown', (e)=>{
        if(!audio.duration) return;
        const step = audio.duration * 0.02; // 2% por pulsación
        if(['ArrowRight','ArrowUp'].includes(e.key)){ e.preventDefault(); audio.currentTime = Math.min(audio.duration, audio.currentTime + step); }
        if(['ArrowLeft','ArrowDown'].includes(e.key)){ e.preventDefault(); audio.currentTime = Math.max(0, audio.currentTime - step); }
      });
    }

    // Init
    applyFilters();
    grid.querySelectorAll('.player-card').forEach(attachPlayer);

    // Pausar si se cambia de pestaña
    document.addEventListener('visibilitychange', ()=>{
      if(document.hidden && currentAudio){ currentAudio.pause(); if(currentCard) setIcon(currentCard,false); }
    });
  })();
  </script>
</body>
</html>